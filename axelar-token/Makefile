include .env
export

.PHONY: deps
deps:
	forge install --no-commit axelarnetwork/axelar-gmp-sdk-solidity axelarnetwork/interchain-token-service openzeppelin/openzeppelin-contracts

.PHONY: help
help:
	@echo "\033[0;32mAvailable targets:\033[0m"
	@echo "deps               - Install Foundry dependencies"
	@echo "deploy-sender      - Deploy the token sender contract on Polygon Mumbai"
	@echo "deploy-handler     - Deploy the token handler contract on Filecoin Calibrationnet"
	@echo "deposit            - Deposit tokens into the subnet"

.PHONY: deploy-handler
deploy-handler:
	forge script ./script/DeployTokenHandler.s.sol \
		--rpc-url "${$(DEST_NETWORK)__RPC_URL}" \
		--broadcast \
		--skip-simulation

.PHONY: deploy-sender
deploy-sender:
	forge script ./script/DeployTokenSender.s.sol \
		--rpc-url "${$(ORIGIN_NETWORK)__RPC_URL}" \
		--broadcast \
		--skip-simulation

.PHONY: deposit
deposit:
	@echo "Please enter the details:"; \
	read -p "Beneficiary: " BENEFICIARY; \
  	read -p "Amount: " AMOUNT; \
	read -p "Token ID (as registered in Axelar): " TOKEN_ID; \
	read -p "Destination subnet root [314159]: " SUBNET_ROOT; \
	read -p "Destination subnet address: " SUBNET_ADDR; \
	read -p "Gas payment (in origin's native coin) [350000000000000000]: " GAS_PAYMENT; \
	export BENEFICIARY=$$BENEFICIARY; export AMOUNT=$$AMOUNT; export TOKEN_ID=$$TOKEN_ID; export SUBNET_ROOT=$$SUBNET_ROOT; export SUBNET_ADDR=$${SUBNET_ADDR:-314159}; export GAS_PAYMENT=$${GAS_PAYMENT:-350000000000000000}; \
	forge script ./script/Deposit.s.sol \
		--rpc-url "${$(ORIGIN_NETWORK)__RPC_URL}" \
		--broadcast \
		-vvv